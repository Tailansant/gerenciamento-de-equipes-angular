{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as CompaniesActions from 'src/app/store/actions/companies.actions';\nimport * as CompaniesSelectors from 'src/app/store/selectors/companies.selectors';\nimport { take } from 'rxjs/operators'; // Para pegar o valor uma única vez\n\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@ngrx/store\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\n\nfunction CompanyFormPageComponent_mat_progress_bar_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-progress-bar\", 12);\n  }\n}\n\nfunction CompanyFormPageComponent_mat_error_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Nome \\u00E9 obrigat\\u00F3rio. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CompanyFormPageComponent_mat_error_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" CNPJ \\u00E9 obrigat\\u00F3rio. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CompanyFormPageComponent_mat_error_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Formato de CNPJ inv\\u00E1lido. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CompanyFormPageComponent_mat_error_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Endere\\u00E7o \\u00E9 obrigat\\u00F3rio. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CompanyFormPageComponent_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const error_r6 = ctx.ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Erro: \", error_r6 == null ? null : error_r6.message, \" \");\n  }\n}\n\nexport class CompanyFormPageComponent {\n  constructor(fb, store, route, router) {\n    this.fb = fb;\n    this.store = store;\n    this.route = route;\n    this.router = router;\n    this.isEditMode = false;\n    this.companyId = null;\n    this.sub = null;\n    this.isLoading$ = this.store.select(CompaniesSelectors.selectCompaniesLoading);\n    this.error$ = this.store.select(CompaniesSelectors.selectCompaniesError);\n  }\n\n  ngOnInit() {\n    this.companyId = this.route.snapshot.paramMap.get('id');\n    this.isEditMode = !!this.companyId;\n    this.initForm();\n\n    if (this.isEditMode && this.companyId) {\n      this.store.dispatch(CompaniesActions.selectCompany({\n        companyId: this.companyId\n      }));\n      this.sub = this.store.select(CompaniesSelectors.selectSelectedCompany).pipe(take(1)) // Pega o valor atual e se desinscreve\n      .subscribe(company => {\n        if (company) {\n          this.companyForm.patchValue(company);\n        } else {\n          // Se não encontrou a empresa, talvez carregar ou redirecionar\n          console.warn('Empresa não encontrada para edição:', this.companyId);\n          this.router.navigate(['/admin/companies']); // Redireciona de volta\n        }\n      });\n    }\n  }\n\n  initForm() {\n    this.companyForm = this.fb.group({\n      id: [''],\n      name: ['', Validators.required],\n      cnpj: ['', [Validators.required, Validators.pattern(/^\\d{2}\\.\\d{3}\\.\\d{3}\\/\\d{4}\\-\\d{2}$/)]],\n      address: ['', Validators.required] // Adicione outros campos conforme o modelo Company\n\n    });\n  }\n\n  onSubmit() {\n    if (this.companyForm.valid) {\n      const company = this.companyForm.value;\n\n      if (this.isEditMode && this.companyId) {\n        this.store.dispatch(CompaniesActions.updateCompany({\n          id: this.companyId,\n          company\n        }));\n      } else {\n        this.store.dispatch(CompaniesActions.createCompany({\n          company\n        }));\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.sub) {\n      this.sub.unsubscribe();\n    } // Limpa a empresa selecionada no estado ao sair\n\n\n    this.store.dispatch(CompaniesActions.selectCompany({\n      companyId: null\n    }));\n  }\n\n}\n\nCompanyFormPageComponent.ɵfac = function CompanyFormPageComponent_Factory(t) {\n  return new (t || CompanyFormPageComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.Store), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i3.Router));\n};\n\nCompanyFormPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: CompanyFormPageComponent,\n  selectors: [[\"app-company-form-page\"]],\n  decls: 30,\n  vars: 16,\n  consts: [[1, \"container\"], [\"mode\", \"indeterminate\", 4, \"ngIf\"], [1, \"company-form\", 3, \"formGroup\", \"ngSubmit\"], [\"appearance\", \"fill\"], [\"matInput\", \"\", \"formControlName\", \"name\", \"required\", \"\"], [4, \"ngIf\"], [\"matInput\", \"\", \"formControlName\", \"cnpj\", \"placeholder\", \"XX.XXX.XXX/XXXX-XX\", \"required\", \"\"], [\"matInput\", \"\", \"formControlName\", \"address\", \"required\", \"\"], [1, \"form-actions\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"type\", \"submit\", 3, \"disabled\"], [\"mat-button\", \"\", \"routerLink\", \"/admin/companies\"], [\"class\", \"error-message\", 4, \"ngIf\"], [\"mode\", \"indeterminate\"], [1, \"error-message\"]],\n  template: function CompanyFormPageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\");\n      i0.ɵɵtext(2);\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(3, CompanyFormPageComponent_mat_progress_bar_3_Template, 1, 0, \"mat-progress-bar\", 1);\n      i0.ɵɵpipe(4, \"async\");\n      i0.ɵɵelementStart(5, \"form\", 2);\n      i0.ɵɵlistener(\"ngSubmit\", function CompanyFormPageComponent_Template_form_ngSubmit_5_listener() {\n        return ctx.onSubmit();\n      });\n      i0.ɵɵelementStart(6, \"mat-form-field\", 3)(7, \"mat-label\");\n      i0.ɵɵtext(8, \"Nome da Empresa\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(9, \"input\", 4);\n      i0.ɵɵtemplate(10, CompanyFormPageComponent_mat_error_10_Template, 2, 0, \"mat-error\", 5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(11, \"mat-form-field\", 3)(12, \"mat-label\");\n      i0.ɵɵtext(13, \"CNPJ\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(14, \"input\", 6);\n      i0.ɵɵtemplate(15, CompanyFormPageComponent_mat_error_15_Template, 2, 0, \"mat-error\", 5);\n      i0.ɵɵtemplate(16, CompanyFormPageComponent_mat_error_16_Template, 2, 0, \"mat-error\", 5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(17, \"mat-form-field\", 3)(18, \"mat-label\");\n      i0.ɵɵtext(19, \"Endere\\u00E7o\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(20, \"textarea\", 7);\n      i0.ɵɵtemplate(21, CompanyFormPageComponent_mat_error_21_Template, 2, 0, \"mat-error\", 5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(22, \"div\", 8)(23, \"button\", 9);\n      i0.ɵɵpipe(24, \"async\");\n      i0.ɵɵtext(25);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(26, \"button\", 10);\n      i0.ɵɵtext(27, \"Cancelar\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵtemplate(28, CompanyFormPageComponent_div_28_Template, 2, 1, \"div\", 11);\n      i0.ɵɵpipe(29, \"async\");\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      let tmp_3_0;\n      let tmp_4_0;\n      let tmp_5_0;\n      let tmp_6_0;\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate(ctx.isEditMode ? \"Editar Empresa\" : \"Adicionar Empresa\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(4, 10, ctx.isLoading$));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"formGroup\", ctx.companyForm);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngIf\", ((tmp_3_0 = ctx.companyForm.get(\"name\")) == null ? null : tmp_3_0.hasError(\"required\")) && ((tmp_3_0 = ctx.companyForm.get(\"name\")) == null ? null : tmp_3_0.touched));\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngIf\", ((tmp_4_0 = ctx.companyForm.get(\"cnpj\")) == null ? null : tmp_4_0.hasError(\"required\")) && ((tmp_4_0 = ctx.companyForm.get(\"cnpj\")) == null ? null : tmp_4_0.touched));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ((tmp_5_0 = ctx.companyForm.get(\"cnpj\")) == null ? null : tmp_5_0.hasError(\"pattern\")) && ((tmp_5_0 = ctx.companyForm.get(\"cnpj\")) == null ? null : tmp_5_0.touched));\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngIf\", ((tmp_6_0 = ctx.companyForm.get(\"address\")) == null ? null : tmp_6_0.hasError(\"required\")) && ((tmp_6_0 = ctx.companyForm.get(\"address\")) == null ? null : tmp_6_0.touched));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"disabled\", ctx.companyForm.invalid || i0.ɵɵpipeBind1(24, 12, ctx.isLoading$));\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\" \", ctx.isEditMode ? \"Salvar Altera\\u00E7\\u00F5es\" : \"Criar Empresa\", \" \");\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(29, 14, ctx.error$));\n    }\n  },\n  dependencies: [i4.NgIf, i3.RouterLink, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.RequiredValidator, i1.FormGroupDirective, i1.FormControlName, i4.AsyncPipe],\n  styles: [\".container[_ngcontent-%COMP%] {\\n  padding: 20px;\\n  max-width: 600px;\\n  margin: 20px auto;\\n  background-color: #fff;\\n  border-radius: 8px;\\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\\n}\\n.container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%] {\\n  text-align: center;\\n  color: #3f51b5;\\n  margin-bottom: 20px;\\n}\\n.container[_ngcontent-%COMP%]   .company-form[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n}\\n.container[_ngcontent-%COMP%]   .company-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%] {\\n  width: 100%;\\n  margin-bottom: 15px;\\n}\\n.container[_ngcontent-%COMP%]   .company-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%] {\\n  display: flex;\\n  justify-content: flex-end;\\n  gap: 10px;\\n  margin-top: 20px;\\n}\\n.container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%] {\\n  color: red;\\n  text-align: center;\\n  margin-top: 20px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBhbnktZm9ybS1wYWdlLmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0ksYUFBQTtFQUNBLGdCQUFBO0VBQ0EsaUJBQUE7RUFDQSxzQkFBQTtFQUNBLGtCQUFBO0VBQ0Esd0NBQUE7QUFDSjtBQUNJO0VBQ0ksa0JBQUE7RUFDQSxjQUFBO0VBQ0EsbUJBQUE7QUFDUjtBQUVJO0VBQ0ksYUFBQTtFQUNBLHNCQUFBO0FBQVI7QUFFUTtFQUNJLFdBQUE7RUFDQSxtQkFBQTtBQUFaO0FBR1E7RUFDSSxhQUFBO0VBQ0EseUJBQUE7RUFDQSxTQUFBO0VBQ0EsZ0JBQUE7QUFEWjtBQUtJO0VBQ0ksVUFBQTtFQUNBLGtCQUFBO0VBQ0EsZ0JBQUE7QUFIUiIsImZpbGUiOiJjb21wYW55LWZvcm0tcGFnZS5jb21wb25lbnQuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIi5jb250YWluZXIge1xyXG4gICAgcGFkZGluZzogMjBweDtcclxuICAgIG1heC13aWR0aDogNjAwcHg7XHJcbiAgICBtYXJnaW46IDIwcHggYXV0bztcclxuICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7XHJcbiAgICBib3JkZXItcmFkaXVzOiA4cHg7XHJcbiAgICBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLCAwLCAwLCAwLjEpO1xyXG5cclxuICAgIGgyIHtcclxuICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XHJcbiAgICAgICAgY29sb3I6ICMzZjUxYjU7XHJcbiAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDtcclxuICAgIH1cclxuXHJcbiAgICAuY29tcGFueS1mb3JtIHtcclxuICAgICAgICBkaXNwbGF5OiBmbGV4O1xyXG4gICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XHJcblxyXG4gICAgICAgIG1hdC1mb3JtLWZpZWxkIHtcclxuICAgICAgICAgICAgd2lkdGg6IDEwMCU7XHJcbiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDE1cHg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAuZm9ybS1hY3Rpb25zIHtcclxuICAgICAgICAgICAgZGlzcGxheTogZmxleDtcclxuICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDtcclxuICAgICAgICAgICAgZ2FwOiAxMHB4O1xyXG4gICAgICAgICAgICBtYXJnaW4tdG9wOiAyMHB4O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAuZXJyb3ItbWVzc2FnZSB7XHJcbiAgICAgICAgY29sb3I6IHJlZDtcclxuICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XHJcbiAgICAgICAgbWFyZ2luLXRvcDogMjBweDtcclxuICAgIH1cclxufSJdfQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["Validators","CompaniesActions","CompaniesSelectors","take","i0","CompanyFormPageComponent","constructor","fb","store","route","router","isLoading$","select","selectCompaniesLoading","error$","selectCompaniesError","ngOnInit","companyId","snapshot","paramMap","get","isEditMode","initForm","dispatch","selectCompany","sub","selectSelectedCompany","pipe","subscribe","company","companyForm","patchValue","console","warn","navigate","group","id","name","required","cnpj","pattern","address","onSubmit","valid","value","updateCompany","createCompany","ngOnDestroy","unsubscribe","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["E:\\project-management-app-main\\project-management-app-main\\project-management-app\\src\\app\\admin\\pages\\company-form-page\\company-form-page.component.ts","E:\\project-management-app-main\\project-management-app-main\\project-management-app\\src\\app\\admin\\pages\\company-form-page\\company-form-page.component.html"],"sourcesContent":["import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { Store } from '@ngrx/store';\r\nimport { Observable, Subscription } from 'rxjs';\r\nimport { Company } from 'src/app/core/models/company.model';\r\nimport * as CompaniesActions from 'src/app/store/actions/companies.actions';\r\nimport * as CompaniesSelectors from 'src/app/store/selectors/companies.selectors';\r\nimport { take } from 'rxjs/operators'; // Para pegar o valor uma única vez\r\n\r\n@Component({\r\n    selector: 'app-company-form-page',\r\n    templateUrl: './company-form-page.component.html',\r\n    styleUrls: ['./company-form-page.component.scss']\r\n})\r\nexport class CompanyFormPageComponent implements OnInit, OnDestroy {\r\n    companyForm!: FormGroup;\r\n    isEditMode: boolean = false;\r\n    companyId: string | null = null;\r\n    isLoading$: Observable<boolean>;\r\n    error$: Observable<any>;\r\n    private sub: Subscription | null = null;\r\n\r\n    constructor(\r\n        private fb: FormBuilder,\r\n        private store: Store,\r\n        private route: ActivatedRoute,\r\n        private router: Router\r\n    ) {\r\n        this.isLoading$ = this.store.select(CompaniesSelectors.selectCompaniesLoading);\r\n        this.error$ = this.store.select(CompaniesSelectors.selectCompaniesError);\r\n    }\r\n\r\n    ngOnInit(): void {\r\n        this.companyId = this.route.snapshot.paramMap.get('id');\r\n        this.isEditMode = !!this.companyId;\r\n\r\n        this.initForm();\r\n\r\n        if (this.isEditMode && this.companyId) {\r\n            this.store.dispatch(CompaniesActions.selectCompany({ companyId: this.companyId }));\r\n            this.sub = this.store.select(CompaniesSelectors.selectSelectedCompany)\r\n                .pipe(take(1)) // Pega o valor atual e se desinscreve\r\n                .subscribe(company => {\r\n                    if (company) {\r\n                        this.companyForm.patchValue(company);\r\n                    } else {\r\n                        // Se não encontrou a empresa, talvez carregar ou redirecionar\r\n                        console.warn('Empresa não encontrada para edição:', this.companyId);\r\n                        this.router.navigate(['/admin/companies']); // Redireciona de volta\r\n                    }\r\n                });\r\n        }\r\n    }\r\n\r\n    initForm(): void {\r\n        this.companyForm = this.fb.group({\r\n            id: [''], // ID é apenas para edição, será gerado no backend para criação\r\n            name: ['', Validators.required],\r\n            cnpj: ['', [Validators.required, Validators.pattern(/^\\d{2}\\.\\d{3}\\.\\d{3}\\/\\d{4}\\-\\d{2}$/)]], // Exemplo de regex para CNPJ\r\n            address: ['', Validators.required],\r\n            // Adicione outros campos conforme o modelo Company\r\n        });\r\n    }\r\n\r\n    onSubmit(): void {\r\n        if (this.companyForm.valid) {\r\n            const company: Company = this.companyForm.value;\r\n            if (this.isEditMode && this.companyId) {\r\n                this.store.dispatch(CompaniesActions.updateCompany({ id: this.companyId, company }));\r\n            } else {\r\n                this.store.dispatch(CompaniesActions.createCompany({ company }));\r\n            }\r\n        }\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n        if (this.sub) {\r\n            this.sub.unsubscribe();\r\n        }\r\n        // Limpa a empresa selecionada no estado ao sair\r\n        this.store.dispatch(CompaniesActions.selectCompany({ companyId: null }));\r\n    }\r\n}","<div class=\"container\">\r\n    <h2>{{ isEditMode ? 'Editar Empresa' : 'Adicionar Empresa' }}</h2>\r\n\r\n    <mat-progress-bar *ngIf=\"isLoading$ | async\" mode=\"indeterminate\"></mat-progress-bar>\r\n\r\n    <form [formGroup]=\"companyForm\" (ngSubmit)=\"onSubmit()\" class=\"company-form\">\r\n        <mat-form-field appearance=\"fill\">\r\n            <mat-label>Nome da Empresa</mat-label>\r\n            <input matInput formControlName=\"name\" required>\r\n            <mat-error *ngIf=\"companyForm.get('name')?.hasError('required') && companyForm.get('name')?.touched\">\r\n                Nome é obrigatório.\r\n            </mat-error>\r\n        </mat-form-field>\r\n\r\n        <mat-form-field appearance=\"fill\">\r\n            <mat-label>CNPJ</mat-label>\r\n            <input matInput formControlName=\"cnpj\" placeholder=\"XX.XXX.XXX/XXXX-XX\" required>\r\n            <mat-error *ngIf=\"companyForm.get('cnpj')?.hasError('required') && companyForm.get('cnpj')?.touched\">\r\n                CNPJ é obrigatório.\r\n            </mat-error>\r\n            <mat-error *ngIf=\"companyForm.get('cnpj')?.hasError('pattern') && companyForm.get('cnpj')?.touched\">\r\n                Formato de CNPJ inválido.\r\n            </mat-error>\r\n        </mat-form-field>\r\n\r\n        <mat-form-field appearance=\"fill\">\r\n            <mat-label>Endereço</mat-label>\r\n            <textarea matInput formControlName=\"address\" required></textarea>\r\n            <mat-error *ngIf=\"companyForm.get('address')?.hasError('required') && companyForm.get('address')?.touched\">\r\n                Endereço é obrigatório.\r\n            </mat-error>\r\n        </mat-form-field>\r\n\r\n        <div class=\"form-actions\">\r\n            <button mat-raised-button color=\"primary\" type=\"submit\"\r\n                [disabled]=\"companyForm.invalid || (isLoading$ | async)\">\r\n                {{ isEditMode ? 'Salvar Alterações' : 'Criar Empresa' }}\r\n            </button>\r\n            <button mat-button routerLink=\"/admin/companies\">Cancelar</button>\r\n        </div>\r\n    </form>\r\n\r\n    <div *ngIf=\"error$ | async as error\" class=\"error-message\">\r\n        Erro: {{ error?.message }}\r\n    </div>\r\n</div>"]},"metadata":{},"sourceType":"module"}