{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { combineLatest } from 'rxjs';\nimport * as DesignersActions from 'src/app/store/actions/designers.actions';\nimport * as DesignersSelectors from 'src/app/store/selectors/designers.selectors';\nimport * as AuthSelectors from 'src/app/store/selectors/auth.selectors';\nimport { filter, take, map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@ngrx/store\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\n\nfunction DesignerFormPageComponent_mat_progress_bar_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-progress-bar\", 13);\n  }\n}\n\nfunction DesignerFormPageComponent_mat_error_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Nome \\u00E9 obrigat\\u00F3rio. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DesignerFormPageComponent_mat_error_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Email \\u00E9 obrigat\\u00F3rio. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DesignerFormPageComponent_mat_error_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Formato de email inv\\u00E1lido. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DesignerFormPageComponent_mat_error_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Especialidade \\u00E9 obrigat\\u00F3ria. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DesignerFormPageComponent_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const error_r6 = ctx.ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Erro: \", error_r6 == null ? null : error_r6.message, \" \");\n  }\n}\n\nexport class DesignerFormPageComponent {\n  constructor(fb, store, route, router) {\n    this.fb = fb;\n    this.store = store;\n    this.route = route;\n    this.router = router;\n    this.isEditMode = false;\n    this.designerId = null;\n    this.userCompanyId = null;\n    this.sub = null;\n    this.isLoading$ = this.store.select(DesignersSelectors.selectDesignersLoading);\n    this.error$ = this.store.select(DesignersSelectors.selectDesignersError);\n  }\n\n  ngOnInit() {\n    this.designerId = this.route.snapshot.paramMap.get('id');\n    this.isEditMode = !!this.designerId;\n    this.initForm();\n    this.sub = combineLatest([this.store.select(AuthSelectors.selectUserCompanyId), this.store.select(DesignersSelectors.selectAllDesigners) // Assumimos que os designers já estão carregados para a empresa\n    ]).pipe(filter(([companyId, designers]) => !!companyId), // Garante que companyId existe\n    map(([companyId, designers]) => {\n      this.userCompanyId = companyId;\n\n      if (this.isEditMode && this.designerId) {\n        return designers.find(d => d.id === this.designerId);\n      }\n\n      return null;\n    }), take(1) // Pega o primeiro valor e completa\n    ).subscribe(designer => {\n      if (this.isEditMode && designer) {\n        this.designerForm.patchValue(designer);\n      } else if (this.isEditMode && !designer) {\n        console.warn('Projetista não encontrado para edição:', this.designerId);\n        this.router.navigate(['/company/designers']);\n      }\n    }); // Se estiver criando, o companyId do usuário já estará no formulário\n\n    this.store.select(AuthSelectors.selectUserCompanyId).pipe(filter(companyId => !!companyId), take(1)).subscribe(companyId => {\n      if (!this.isEditMode) {\n        this.designerForm.patchValue({\n          companyId: companyId\n        });\n      }\n    });\n  }\n\n  initForm() {\n    this.designerForm = this.fb.group({\n      id: [''],\n      name: ['', Validators.required],\n      email: ['', [Validators.required, Validators.email]],\n      specialty: ['', Validators.required],\n      companyId: ['', Validators.required] // Campo hidden ou preenchido automaticamente\n\n    });\n  }\n\n  onSubmit() {\n    if (this.designerForm.valid) {\n      const designer = this.designerForm.value;\n\n      if (this.isEditMode && this.designerId) {\n        this.store.dispatch(DesignersActions.updateDesigner({\n          id: this.designerId,\n          designer\n        }));\n      } else {\n        this.store.dispatch(DesignersActions.createDesigner({\n          designer\n        }));\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.sub) {\n      this.sub.unsubscribe();\n    }\n\n    this.store.dispatch(DesignersActions.selectDesigner({\n      designerId: null\n    }));\n  }\n\n}\n\nDesignerFormPageComponent.ɵfac = function DesignerFormPageComponent_Factory(t) {\n  return new (t || DesignerFormPageComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.Store), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i3.Router));\n};\n\nDesignerFormPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: DesignerFormPageComponent,\n  selectors: [[\"app-designer-form-page\"]],\n  decls: 31,\n  vars: 16,\n  consts: [[1, \"container\"], [\"mode\", \"indeterminate\", 4, \"ngIf\"], [1, \"designer-form\", 3, \"formGroup\", \"ngSubmit\"], [\"appearance\", \"fill\"], [\"matInput\", \"\", \"formControlName\", \"name\", \"required\", \"\"], [4, \"ngIf\"], [\"matInput\", \"\", \"formControlName\", \"email\", \"type\", \"email\", \"required\", \"\"], [\"matInput\", \"\", \"formControlName\", \"specialty\", \"required\", \"\"], [\"type\", \"hidden\", \"formControlName\", \"companyId\"], [1, \"form-actions\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"type\", \"submit\", 3, \"disabled\"], [\"mat-button\", \"\", \"routerLink\", \"/company/designers\"], [\"class\", \"error-message\", 4, \"ngIf\"], [\"mode\", \"indeterminate\"], [1, \"error-message\"]],\n  template: function DesignerFormPageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\");\n      i0.ɵɵtext(2);\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(3, DesignerFormPageComponent_mat_progress_bar_3_Template, 1, 0, \"mat-progress-bar\", 1);\n      i0.ɵɵpipe(4, \"async\");\n      i0.ɵɵelementStart(5, \"form\", 2);\n      i0.ɵɵlistener(\"ngSubmit\", function DesignerFormPageComponent_Template_form_ngSubmit_5_listener() {\n        return ctx.onSubmit();\n      });\n      i0.ɵɵelementStart(6, \"mat-form-field\", 3)(7, \"mat-label\");\n      i0.ɵɵtext(8, \"Nome do Projetista\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(9, \"input\", 4);\n      i0.ɵɵtemplate(10, DesignerFormPageComponent_mat_error_10_Template, 2, 0, \"mat-error\", 5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(11, \"mat-form-field\", 3)(12, \"mat-label\");\n      i0.ɵɵtext(13, \"Email\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(14, \"input\", 6);\n      i0.ɵɵtemplate(15, DesignerFormPageComponent_mat_error_15_Template, 2, 0, \"mat-error\", 5);\n      i0.ɵɵtemplate(16, DesignerFormPageComponent_mat_error_16_Template, 2, 0, \"mat-error\", 5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(17, \"mat-form-field\", 3)(18, \"mat-label\");\n      i0.ɵɵtext(19, \"Especialidade\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(20, \"input\", 7);\n      i0.ɵɵtemplate(21, DesignerFormPageComponent_mat_error_21_Template, 2, 0, \"mat-error\", 5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(22, \"input\", 8);\n      i0.ɵɵelementStart(23, \"div\", 9)(24, \"button\", 10);\n      i0.ɵɵpipe(25, \"async\");\n      i0.ɵɵtext(26);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(27, \"button\", 11);\n      i0.ɵɵtext(28, \"Cancelar\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵtemplate(29, DesignerFormPageComponent_div_29_Template, 2, 1, \"div\", 12);\n      i0.ɵɵpipe(30, \"async\");\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      let tmp_3_0;\n      let tmp_4_0;\n      let tmp_5_0;\n      let tmp_6_0;\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate(ctx.isEditMode ? \"Editar Projetista\" : \"Adicionar Projetista\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(4, 10, ctx.isLoading$));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"formGroup\", ctx.designerForm);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngIf\", ((tmp_3_0 = ctx.designerForm.get(\"name\")) == null ? null : tmp_3_0.hasError(\"required\")) && ((tmp_3_0 = ctx.designerForm.get(\"name\")) == null ? null : tmp_3_0.touched));\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngIf\", ((tmp_4_0 = ctx.designerForm.get(\"email\")) == null ? null : tmp_4_0.hasError(\"required\")) && ((tmp_4_0 = ctx.designerForm.get(\"email\")) == null ? null : tmp_4_0.touched));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ((tmp_5_0 = ctx.designerForm.get(\"email\")) == null ? null : tmp_5_0.hasError(\"email\")) && ((tmp_5_0 = ctx.designerForm.get(\"email\")) == null ? null : tmp_5_0.touched));\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngIf\", ((tmp_6_0 = ctx.designerForm.get(\"specialty\")) == null ? null : tmp_6_0.hasError(\"required\")) && ((tmp_6_0 = ctx.designerForm.get(\"specialty\")) == null ? null : tmp_6_0.touched));\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"disabled\", ctx.designerForm.invalid || i0.ɵɵpipeBind1(25, 12, ctx.isLoading$));\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\" \", ctx.isEditMode ? \"Salvar Altera\\u00E7\\u00F5es\" : \"Criar Projetista\", \" \");\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(30, 14, ctx.error$));\n    }\n  },\n  dependencies: [i4.NgIf, i3.RouterLink, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.RequiredValidator, i1.FormGroupDirective, i1.FormControlName, i4.AsyncPipe],\n  styles: [\"var[_ngcontent-%COMP%]   resource[_ngcontent-%COMP%];\\n (()[_ngcontent-%COMP%]   =[_ngcontent-%COMP%] >  { // webpackBootstrap\\n \\tvar __webpack_modules__ = ({\\n\\n 614:\\n\\n (() => {\\n\\nthrow new Error(\\\"Module build failed (from ./node_modules/sass-loader/dist/cjs.js):\\\\nSassError: Can't find stylesheet to import.\\\\n  \\u2577\\\\n1 \\u2502 @import '../../admin/pages/company-form-page/company-form-page.component.scss'; \\\\n  \\u2502         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\\\n  \\u2575\\\\n  src\\\\\\\\app\\\\\\\\company\\\\\\\\pages\\\\\\\\designer-form-page\\\\\\\\designer-form-page.component.scss 1:9  root stylesheet\\\");\\n\\n })\\n\\n \\t});\\n\\n \\t\\n \\t// startup\\n \\t// Load entry module and return exports\\n \\t// This entry module doesn't tell about it's top-level declarations so it can't be inlined\\n \\tvar __webpack_exports__ = {};\\n \\t__webpack_modules__[614]();\\n \\tresource = __webpack_exports__;\\n \\t\\n })()\\n;\"]\n});","map":{"version":3,"mappings":"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","names":["Validators","combineLatest","DesignersActions","DesignersSelectors","AuthSelectors","filter","take","map","i0","DesignerFormPageComponent","constructor","fb","store","route","router","isLoading$","select","selectDesignersLoading","error$","selectDesignersError","ngOnInit","designerId","snapshot","paramMap","get","isEditMode","initForm","sub","selectUserCompanyId","selectAllDesigners","pipe","companyId","designers","userCompanyId","find","d","id","subscribe","designer","designerForm","patchValue","console","warn","navigate","group","name","required","email","specialty","onSubmit","valid","value","dispatch","updateDesigner","createDesigner","ngOnDestroy","unsubscribe","selectDesigner","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["E:\\project-management-app-main\\project-management-app-main\\project-management-app\\src\\app\\company\\pages\\designer-form-page\\designer-form-page.component.ts","E:\\project-management-app-main\\project-management-app-main\\project-management-app\\src\\app\\company\\pages\\designer-form-page\\designer-form-page.component.html"],"sourcesContent":["import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { Store } from '@ngrx/store';\r\nimport { Observable, Subscription, combineLatest } from 'rxjs';\r\nimport { Designer } from 'src/app/core/models/designer.model';\r\nimport * as DesignersActions from 'src/app/store/actions/designers.actions';\r\nimport * as DesignersSelectors from 'src/app/store/selectors/designers.selectors';\r\nimport * as AuthSelectors from 'src/app/store/selectors/auth.selectors';\r\nimport { filter, take, map } from 'rxjs/operators';\r\n\r\n@Component({\r\n    selector: 'app-designer-form-page',\r\n    templateUrl: './designer-form-page.component.html',\r\n    styleUrls: ['./designer-form-page.component.scss']\r\n})\r\nexport class DesignerFormPageComponent implements OnInit, OnDestroy {\r\n    designerForm!: FormGroup;\r\n    isEditMode: boolean = false;\r\n    designerId: string | null = null;\r\n    isLoading$: Observable<boolean>;\r\n    error$: Observable<any>;\r\n    private userCompanyId: string | null = null;\r\n    private sub: Subscription | null = null;\r\n\r\n    constructor(\r\n        private fb: FormBuilder,\r\n        private store: Store,\r\n        private route: ActivatedRoute,\r\n        private router: Router\r\n    ) {\r\n        this.isLoading$ = this.store.select(DesignersSelectors.selectDesignersLoading);\r\n        this.error$ = this.store.select(DesignersSelectors.selectDesignersError);\r\n    }\r\n\r\n    ngOnInit(): void {\r\n        this.designerId = this.route.snapshot.paramMap.get('id');\r\n        this.isEditMode = !!this.designerId;\r\n\r\n        this.initForm();\r\n\r\n        this.sub = combineLatest([\r\n            this.store.select(AuthSelectors.selectUserCompanyId),\r\n            this.store.select(DesignersSelectors.selectAllDesigners) // Assumimos que os designers já estão carregados para a empresa\r\n        ])\r\n            .pipe(\r\n                filter(([companyId, designers]) => !!companyId), // Garante que companyId existe\r\n                map(([companyId, designers]) => {\r\n                    this.userCompanyId = companyId;\r\n                    if (this.isEditMode && this.designerId) {\r\n                        return designers.find(d => d.id === this.designerId);\r\n                    }\r\n                    return null;\r\n                }),\r\n                take(1) // Pega o primeiro valor e completa\r\n            )\r\n            .subscribe(designer => {\r\n                if (this.isEditMode && designer) {\r\n                    this.designerForm.patchValue(designer);\r\n                } else if (this.isEditMode && !designer) {\r\n                    console.warn('Projetista não encontrado para edição:', this.designerId);\r\n                    this.router.navigate(['/company/designers']);\r\n                }\r\n            });\r\n\r\n        // Se estiver criando, o companyId do usuário já estará no formulário\r\n        this.store.select(AuthSelectors.selectUserCompanyId).pipe(\r\n            filter(companyId => !!companyId),\r\n            take(1)\r\n        ).subscribe(companyId => {\r\n            if (!this.isEditMode) {\r\n                this.designerForm.patchValue({ companyId: companyId });\r\n            }\r\n        });\r\n    }\r\n\r\n    initForm(): void {\r\n        this.designerForm = this.fb.group({\r\n            id: [''], // ID é apenas para edição\r\n            name: ['', Validators.required],\r\n            email: ['', [Validators.required, Validators.email]],\r\n            specialty: ['', Validators.required],\r\n            companyId: ['', Validators.required] // Campo hidden ou preenchido automaticamente\r\n        });\r\n    }\r\n\r\n    onSubmit(): void {\r\n        if (this.designerForm.valid) {\r\n            const designer: Designer = this.designerForm.value;\r\n            if (this.isEditMode && this.designerId) {\r\n                this.store.dispatch(DesignersActions.updateDesigner({ id: this.designerId, designer }));\r\n            } else {\r\n                this.store.dispatch(DesignersActions.createDesigner({ designer }));\r\n            }\r\n        }\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n        if (this.sub) {\r\n            this.sub.unsubscribe();\r\n        }\r\n        this.store.dispatch(DesignersActions.selectDesigner({ designerId: null }));\r\n    }\r\n}","<div class=\"container\">\r\n    <h2>{{ isEditMode ? 'Editar Projetista' : 'Adicionar Projetista' }}</h2>\r\n\r\n    <mat-progress-bar *ngIf=\"isLoading$ | async\" mode=\"indeterminate\"></mat-progress-bar>\r\n\r\n    <form [formGroup]=\"designerForm\" (ngSubmit)=\"onSubmit()\" class=\"designer-form\">\r\n        <mat-form-field appearance=\"fill\">\r\n            <mat-label>Nome do Projetista</mat-label>\r\n            <input matInput formControlName=\"name\" required>\r\n            <mat-error *ngIf=\"designerForm.get('name')?.hasError('required') && designerForm.get('name')?.touched\">\r\n                Nome é obrigatório.\r\n            </mat-error>\r\n        </mat-form-field>\r\n\r\n        <mat-form-field appearance=\"fill\">\r\n            <mat-label>Email</mat-label>\r\n            <input matInput formControlName=\"email\" type=\"email\" required>\r\n            <mat-error *ngIf=\"designerForm.get('email')?.hasError('required') && designerForm.get('email')?.touched\">\r\n                Email é obrigatório.\r\n            </mat-error>\r\n            <mat-error *ngIf=\"designerForm.get('email')?.hasError('email') && designerForm.get('email')?.touched\">\r\n                Formato de email inválido.\r\n            </mat-error>\r\n        </mat-form-field>\r\n\r\n        <mat-form-field appearance=\"fill\">\r\n            <mat-label>Especialidade</mat-label>\r\n            <input matInput formControlName=\"specialty\" required>\r\n            <mat-error\r\n                *ngIf=\"designerForm.get('specialty')?.hasError('required') && designerForm.get('specialty')?.touched\">\r\n                Especialidade é obrigatória.\r\n            </mat-error>\r\n        </mat-form-field>\r\n\r\n        <input type=\"hidden\" formControlName=\"companyId\">\r\n\r\n        <div class=\"form-actions\">\r\n            <button mat-raised-button color=\"primary\" type=\"submit\"\r\n                [disabled]=\"designerForm.invalid || (isLoading$ | async)\">\r\n                {{ isEditMode ? 'Salvar Alterações' : 'Criar Projetista' }}\r\n            </button>\r\n            <button mat-button routerLink=\"/company/designers\">Cancelar</button>\r\n        </div>\r\n    </form>\r\n\r\n    <div *ngIf=\"error$ | async as error\" class=\"error-message\">\r\n        Erro: {{ error?.message }}\r\n    </div>\r\n</div>"]},"metadata":{},"sourceType":"module"}